---
- name: Check etcd health
  ansible.builtin.uri:
    url: "{% if tls_cert_generate | bool %}https{% else %}http{% endif %}://{{ inventory_hostname }}:2379/health"
    method: GET
    return_content: true
    validate_certs: "{% if tls_cert_generate | bool %}true{% else %}false{% endif %}"
    ca_path: "{% if tls_cert_generate | bool %}{{ tls_etcd_ca_cert_path }}{% else %}''{% endif %}"
    client_cert: "{% if tls_cert_generate | bool %}{{ tls_etcd_cert_path }}{% else %}''{% endif %}"
    client_key: "{% if tls_cert_generate | bool %}{{ tls_etcd_privatekey_path }}{% else %}''{% endif %}"
  register: etcd_health_status
  failed_when: "(etcd_health_status.content | from_json).health != 'true'"
  when: dcs_type == "etcd"
